#Funciona no ffmpeg 5.1

sudo ffmpeg -hide_banner -nostats -v level+error -threads 6 -thread_queue_size 512 -hwaccel_device 0 -hwaccel cuvid -hwaccel_output_format cuda -readrate 1 -ss 183.5784349341484 -i "/var/lib/ffplayout/tv-media/1/rabinorelogio.mp4" -filter_complex "[0:v:0]scale_npp=format=yuv420p,scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease,hwdownload,pad=1280:720:(ow-iw)/2:(oh-ih)/2:color=black,setdar=16:9,setsar=1:1,hwupload[v];movie=/var/lib/ffplayout/tv-media/1/00-assets/logo.png[l0];[l0]format=rgba,colorchannelmixer=aa=0.7,hwupload_cuda[l];[v][l]overlay_cuda=main_w-overlay_w-W-w-12:12,realtime=speed=1.0004432211414036[vout0];[0:a:0]anull[aout0]" -map "[vout0]" -map "[aout0]" -c:v h264_nvenc -preset p4 -tune ll -rc:v vbr -cq:v 23 -b:v 1300k -maxrate 1300k -bufsize 2600k -profile:v main -level 3.1 -g 50 -keyint_min 25 -sc_threshold 0 -c:a aac -ar 44100 -b:a 128k -flags +cgop -muxpreload 0 -muxdelay 0 -f hls -hls_time 6 -hls_list_size 600 -hls_flags append_list+delete_segments+omit_endlist -hls_segment_filename "/usr/share/ffplayout/public/1/live/stream-%d.ts" "/usr/share/ffplayout/public/1/live/stream.m3u8"

#Funciona no ffmpeg 7.1 com perda de desempenho

sudo ffmpeg -hide_banner -nostats -v level+error -threads 6 -thread_queue_size 512 -hwaccel_device 0 -hwaccel cuvid -hwaccel_output_format cuda -readrate 1 -ss 183.5784349341484 -i "/var/lib/ffplayout/tv-media/1/rabinorelogio.mp4" -filter_complex "[0:v:0]scale_npp=format=yuv420p,scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease,hwdownload,format=yuv420p,pad=1280:720:(ow-iw)/2:(oh-ih)/2:color=black,setdar=16:9,setsar=1:1,format=yuv420p,hwupload_cuda[v];movie=/var/lib/ffplayout/tv-media/1/00-assets/logo.png[l0];[l0]format=rgba,colorchannelmixer=aa=0.7,hwupload_cuda[l];[v][l]overlay_cuda=main_w-overlay_w-W-w-12:12,realtime=speed=1.0004432211414036[vout0];[0:a:0]anull[aout0]" -map "[vout0]" -map "[aout0]" -c:v h264_nvenc -preset p4 -tune ll -rc:v vbr -cq:v 23 -b:v 1300k -maxrate 1300k -bufsize 2600k -profile:v main -level 3.1 -g 50 -keyint_min 25 -sc_threshold 0 -c:a aac -ar 44100 -b:a 128k -flags +cgop -muxpreload 0 -muxdelay 0 -f hls -hls_time 6 -hls_list_size 600 -hls_flags append_list+delete_segments+omit_endlist -hls_segment_filename "/usr/share/ffplayout/public/1/live/stream-%d.ts" "/usr/share/ffplayout/public/1/live/stream.m3u8"

#diferença
#5.1
#[0:v:0]scale_npp=format=yuv420p,scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease,hwdownload,pad=1280:720:(ow-iw)/2:(oh-ih)/2:color=black,setdar=16:9,setsar=1:1,hwupload[v]

#7.1
#[0:v:0]scale_npp=format=yuv420p,scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease,hwdownload,format=yuv420p,pad=1280:720:(ow-iw)/2:(oh-ih)/2:color=black,setdar=16:9,setsar=1:1,format=yuv420p,hwupload_cuda[v]

#Funciona no ffmpeg 7.1 com ganho de desempenho

sudo ffmpeg -hide_banner -nostats -v level+error -threads 1 -hwaccel cuda -hwaccel_output_format cuda -extra_hw_frames 3 -c:v h264_cuvid -gpu 0 -readrate 1 -ss 183.5784349341484 -i "/var/lib/ffplayout/tv-media/1/rabbi dov kook.mp4" -filter_complex "[0:v:0]scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease[v];movie=/var/lib/ffplayout/tv-media/1/00-assets/logo.png[l0];[l0]format=nv12,hwupload_cuda[l];[v][l]overlay_cuda=main_w-overlay_w-W-w-12:12,setdar=dar=16/9,realtime=speed=1.0004432211414036[vout0];[0:a:0]anull[aout0]" -map "[vout0]" -map "[aout0]" -c:v h264_nvenc -preset p4 -tune ll -rc:v vbr -cq:v 23 -b:v 1300k -maxrate 1300k -bufsize 2600k -profile:v main -level 3.1 -g 50 -keyint_min 25 -sc_threshold 0 -c:a aac -ar 44100 -b:a 128k -no-scenecut 1 -strict_gop 1 -flags +cgop -muxpreload 0 -muxdelay 0 -f hls -hls_time 6 -hls_list_size 600 -hls_flags append_list+delete_segments+omit_endlist -hls_segment_filename "/usr/share/ffplayout/public/1/live/stream-%d.ts" "/usr/share/ffplayout/public/1/live/stream.m3u8"

#[0:v:0]scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease[v]

#Funciona ffmpeg 7.1 com desempenho maximo até agora.

sudo ffmpeg -hide_banner -nostats -v level+error -threads 6 -thread_queue_size 512 -hwaccel_device 0 -hwaccel cuvid -hwaccel_output_format cuda -readrate 1 -ss 183.5784349341484 -i "/var/lib/ffplayout/tv-media/1/rabbi dov kook.mp4" -filter_complex "[0:v:0]scale_npp=format=yuv420p,scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease,hwdownload,pad=1280:720:(ow-iw)/2:(oh-ih)/2:color=black,setdar=16:9,setsar=1:1,hwupload_cuda[v];movie=/var/lib/ffplayout/tv-media/1/00-assets/logo.png[l0];[l0]format=rgba,colorchannelmixer=aa=0.7,hwupload_cuda[l];[v][l]overlay_cuda=main_w-overlay_w-W-w-12:12,realtime=speed=1.0004432211414036[vout0];[0:a:0]anull[aout0]" -map "[vout0]" -map "[aout0]" -c:v h264_nvenc -preset p4 -tune ll -rc:v vbr -cq:v 23 -b:v 1300k -maxrate 1300k -bufsize 2600k -profile:v main -level 3.1 -g 50 -keyint_min 25 -sc_threshold 0 -c:a aac -ar 44100 -b:a 128k -flags +cgop -muxpreload 0 -muxdelay 0 -f hls -hls_time 6 -hls_list_size 600 -hls_flags append_list+delete_segments+omit_endlist -hls_segment_filename "/usr/share/ffplayout/public/1/live/stream-%d.ts" "/usr/share/ffplayout/public/1/live/stream.m3u8"

#teste

"[0:v:0]scale_npp=format=yuv420p,scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease,hwdownload,pad=1280:720:(ow-iw)/2:(oh-ih)/2:color=black,setdar=16:9,setsar=1:1,hwupload[v];movie=/var/lib/ffplayout/tv-media/1/00-assets/logo.png[l0];[l0]format=rgba,colorchannelmixer=aa=0.7,hwupload_cuda[l];[v][l]overlay_cuda=main_w-overlay_w-W-w-12:12,realtime=speed=1.0004432211414036[vout0];[0:a:0]anull[aout0]"

"[0:v:0]scale_npp=format=yuv420p,scale_npp=1280:720:interp_algo=super:force_original_aspect_ratio=decrease,hwdownload,pad=1280:720:(ow-iw)/2:(oh-ih)/2:color=black,setdar=16:9,setsar=1:1,hwupload_cuda[v];movie=/var/lib/ffplayout/tv-media/1/00-assets/logo.png[l0];[l0]format=rgba,colorchannelmixer=aa=0.7,hwupload_cuda[l];[v][l]overlay_cuda=main_w-overlay_w-W-w-12:12,realtime=speed=1.0004432211414036[vout0];[0:a:0]anull[aout0]"